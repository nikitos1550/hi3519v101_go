#include <stdio.h>
#include <string.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <sys/ioctl.h>
#include <fcntl.h>
#include <unistd.h>
#include "hi_comm_video.h"

#include "hi_spi.h"


extern WDR_MODE_E genSensorMode;
extern HI_U8 gu8SensorImageMode;
extern HI_BOOL bSensorInit;

static int g_fd= -1;

void sensor_wdr_1080p30f_init(void);
void sensor_linear_1080p30f_init(void);

int sensor_spi_init(void)
{
    if (g_fd >= 0)
    {
        return 0;
    }     
    unsigned int value;
    int ret = 0;
    char file_name[] = "/dev/spidev0.0";

    g_fd = open(file_name, 0);
    if (g_fd < 0)
    {
        printf("Open %s error!\n",file_name);
        return -1;
    }

    value = SPI_MODE_3 | SPI_LSB_FIRST;// | SPI_LOOP;
    ret = ioctl(g_fd, SPI_IOC_WR_MODE, &value);
    if (ret < 0)
    {
        printf("ioctl SPI_IOC_WR_MODE err, value = %d ret = %d\n", value, ret);
        return ret;
    }

    value = 8;
    ret = ioctl(g_fd, SPI_IOC_WR_BITS_PER_WORD, &value);
    if (ret < 0)
    {
        printf("ioctl SPI_IOC_WR_BITS_PER_WORD err, value = %d ret = %d\n",value, ret);
        return ret;
    }

    value = 2000000;
    ret = ioctl(g_fd, SPI_IOC_WR_MAX_SPEED_HZ, &value);
    if (ret < 0)
    {
        printf("ioctl SPI_IOC_WR_MAX_SPEED_HZ err, value = %d ret = %d\n",value, ret);
        return ret;
    }

    return 0;
}

int sensor_spi_exit(void)
{
    if (g_fd >= 0)
    {
        close(g_fd);
        g_fd = -1;
        return 0;
    }
    return -1;
}

int sensor_write_register(unsigned int addr, unsigned char data)
{
    int ret;
    struct spi_ioc_transfer mesg[1];
    unsigned char  tx_buf[8] = {0};
    unsigned char  rx_buf[8] = {0};
    
    tx_buf[0] = (addr & 0xff00) >> 8;
    tx_buf[0] &= (~0x80);
    tx_buf[1] = addr & 0xff;
    tx_buf[2] = data;

    memset(mesg, 0, sizeof(mesg));  
    mesg[0].tx_buf = (__u32)tx_buf;  
    mesg[0].len    = 3;  
    mesg[0].rx_buf = (__u32)rx_buf; 
    mesg[0].cs_change = 1;

    ret = ioctl(g_fd, SPI_IOC_MESSAGE(1), mesg);
    if (ret < 0) {  
        printf("SPI_IOC_MESSAGE error \n");  
        return -1;  
    }

    return 0;
}

int sensor_read_register(unsigned int addr)
{
    int ret = 0;
    struct spi_ioc_transfer mesg[1];
    unsigned char  tx_buf[8] = {0};
    unsigned char  rx_buf[8] = {0};
    
    tx_buf[0] = (addr & 0xff00) >> 8;
    tx_buf[0] |= 0x80;
    tx_buf[1] = addr & 0xff;
    tx_buf[2] = 0;

    memset(mesg, 0, sizeof(mesg));
    mesg[0].tx_buf = (__u32)tx_buf;
    mesg[0].len    = 3;
    mesg[0].rx_buf = (__u32)rx_buf;
    mesg[0].cs_change = 1;

    ret = ioctl(g_fd, SPI_IOC_MESSAGE(1), mesg);
    if (ret  < 0) {  
        printf("SPI_IOC_MESSAGE error \n");  
        return -1;  
    }
    
    return rx_buf[2];
}

static void delay_ms(int ms) { 
    usleep(ms*1000);
}

void sensor_prog(int* rom) 
{
    int i = 0;
    while (1) {
        int lookup = rom[i++];
        int addr = (lookup >> 16) & 0xFFFF;
        int data = lookup & 0xFFFF;
        if (addr == 0xFFFE) {
            delay_ms(data);
        } else if (addr == 0xFFFF) {
            return;
        } else {
            sensor_write_register(addr, data);
        }
    }
}



void sensor_init()
{
	printf("sensor_init\n");
    bSensorInit = HI_TRUE;
    /* 1. sensor spi init */
    sensor_spi_init();
	if( WDR_MODE_NONE == genSensorMode )
	{
		sensor_linear_1080p30f_init();
	}
	else if(WDR_MODE_2To1_LINE == genSensorMode)
    {
		sensor_wdr_1080p30f_init();
	}
	else
	{
		printf("Not support this mode\n");
		bSensorInit = HI_FALSE;
	}

}

void sensor_exit()
{
    sensor_spi_exit();
	bSensorInit = HI_FALSE;
    return;
}
void Sensor_LoadRegSetting(const int table[][2])
{
	int reg,val;
	int i = 0;
	while(1)
	{
		reg = table[i][0];
		val = table[i][1];

		if(reg == 0xFFFE)
		{
			delay_ms(val);
		}
		else if((reg == 0xFFFF) && (val == 0xFF))
		{
			break;
		}
		else{
			sensor_write_register(reg, val); 
		}
		i++;
	}
	return;
}
static const int Sensor_imx290_1080p30f_DOL_WDR_table_LVDS_10BIT[][2]=
{
	0x0200,	0x01,
	0x0201,	0x00,
	0x0202,	0x01,
	0x0203,	0x00,
	0x0204,	0x10,
	0x0205,	0x00,
	0x0206,	0x00,
	0x0207,	0x00,
	0x0208,	0xA0,
	0x0209,	0x11,
	0x020A,	0x3C,
	0x020B,	0x00,
	0x020C,	0x11,
	0x020D,	0x00,
	0x020E,	0x01,
	0x020F,	0x00,
	0x0210,	0x21,
	0x0211,	0x00,
	0x0212,	0x64,
	0x0213,	0x00,
	0x0214,	0x00,
	0x0215,	0x00,
	0x0216,	0x09,
	0x0217,	0x00,
	//VMAX
	0x0218,	0x94,
	0x0219,	0x05,
	0x021A,	0x00,
	0x021B,	0x00,
	//HMAX
	0x021C,	0x20,
	0x021D,	0x08,
	0x021E,	0xB2,
	0x021F,	0x01,
	0x0220,	0x00,
	0x0221,	0x00,
	0x0222,	0x00,
	0x0224,	0x00,
	0x0225,	0x00,
	0x0226,	0x00,
	0x0228,	0x00,
	0x0229,	0x00,
	0x022A,	0x00,
	0x0230,	0x00,
	0x0231,	0x00,
	0x0232,	0x00,
	0x0234,	0x00,
	0x0235,	0x00,
	0x0236,	0x00,
	0x023A,	0x0C,
	0x023B,	0x00,
	0x023C,	0x00,
	0x023D,	0x00,
	0x023E,	0x49,
	0x023F,	0x04,
	0x0240,	0x00,
	0x0241,	0x00,
	0x0242,	0x9C,
	0x0243,	0x07,
	0x0245,	0x03,
	0x0246,	0xE0,
	0x0247,	0x01,
	0x0248,	0x00,
	0x0249,	0x08,
	0x024A,	0x00,
	0x024B,	0x0A,
	0x025C,	0x18,
	0x025D,	0x00,
	0x025E,	0x20,
	0x025F,	0x01,
	0x0270,	0x02,
	0x0271,	0x11,
	0x029B,	0x10,
	0x029C,	0x22,
	0x02A2,	0x02,
	0x02A6,	0x20,
	0x02A7,	0x00,
	0x02A8,	0x20,
	0x02A9,	0x00,
	0x02AA,	0x20,
	0x02AB,	0x00,
	0x02AC,	0x20,
	0x02B0,	0x43,

	0x0306, 0x15,
	0x0319, 0x9E,
	0x031C, 0x1E,
	0x031D, 0x00,
	0x031E, 0x08, 
	0x0328, 0x05,
	0x0329, 0x1D,	 
	0x033D, 0x83,
	0x0350, 0x03,	 
	0x035E, 0x1A,	 
	0x0364, 0x1A,
	0x037C, 0x12,
	0x037D, 0x00,
	0x037E, 0x00,
	0x03EC, 0x37,
	0x04B8,	0x50,
	0x04B9,	0x10,
	0x04BA,	0x00,
	0x04BB,	0x04,		
	0x04C8,	0x50,
	0x04C9,	0x10,
	0x04CA,	0x00,
	0x04CB,	0x04,
	0x052C, 0xD3,          
	0x052D, 0x10,          
	0x052E, 0x0D,          		
	0x0558, 0x06,          
	0x0559, 0xE1,          
	0x055A, 0x11,          		
	0x0560, 0x1E,          
	0x0561, 0x61,          
	0x0562, 0x10,          
	0x05B0, 0x50,          
	0x05B1, 0x80,          
	0x05B2, 0x1A,          
	0x05B3, 0x04,

	0x0618,	0xB2,
	0x0619,	0x08,
	0x0680,	0x49,

	0x0200, 0x00,
	0xFFFE, 40,	//delay 40ms
	0x0202, 0x00,
	0x024B, 0x0A,
	0xFFFF, 0xFF,//end flag
};
static const int Sensor_imx290_1080p30f_DOL_WDR_table_LVDS_12BIT[][2]=
{
	0x0200,	0x01,
	0x0201,	0x00,
	0x0202,	0x01,
	0x0203,	0x00,
	0x0204,	0x10,
	0x0205,	0x01,
	0x0206,	0x00,
	0x0207,	0x00,
	0x0208,	0xA0,
	0x0209,	0x11,
	0x020A,	0x3C,
	0x020B,	0x00,
	0x020C,	0x11,
	0x020D,	0x00,
	0x020E,	0x01,
	0x020F,	0x00,
	0x0210,	0x21,
	0x0211,	0x00,
	0x0212,	0x64,
	0x0213,	0x00,
	0x0214,	0x00,
	0x0215,	0x00,
	0x0216,	0x09,
	0x0217,	0x00,
	//VMAX
	0x0218,	0xE2,
	0x0219,	0x04,
	0x021A,	0x00,
	0x021B,	0x00,
	//HMAX
	0x021C,	0xBC,
	0x021D,	0x07,
	0x021E,	0xB2,
	0x021F,	0x01,
	0x0220,	0x00,
	0x0221,	0x00,
	0x0222,	0x00,
	0x0224,	0x00,
	0x0225,	0x00,
	0x0226,	0x00,
	0x0228,	0x00,
	0x0229,	0x00,
	0x022A,	0x00,
	0x0230,	0x00,
	0x0231,	0x00,
	0x0232,	0x00,
	0x0234,	0x00,
	0x0235,	0x00,
	0x0236,	0x00,
	0x023A,	0x0C,
	0x023B,	0x00,
	0x023C,	0x00,
	0x023D,	0x00,
	0x023E,	0x49,
	0x023F,	0x04,
	0x0240,	0x00,
	0x0241,	0x00,
	0x0242,	0x9C,
	0x0243,	0x07,
	0x0245,	0x03,
	0x0246,	0xE1,
	0x0247,	0x01,
	0x0248,	0x00,
	0x0249,	0x08,
	0x024A,	0x00,
	0x024B,	0x0A,
	0x025C,	0x18,
	0x025D,	0x00,
	0x025E,	0x20,
	0x025F,	0x01,
	0x0270,	0x02,
	0x0271,	0x11,
	0x029B,	0x10,
	0x029C,	0x22,
	0x02A2,	0x02,
	0x02A6,	0x20,
	0x02A7,	0x00,
	0x02A8,	0x20,
	0x02A9,	0x00,
	0x02AA,	0x20,
	0x02AB,	0x00,
	0x02AC,	0x20,
	0x02B0,	0x43,

	0x0306, 0x15,
	0x0319, 0x9E,
	0x031C, 0x1E,
	0x031D, 0x00,
	0x031E, 0x08, 
	0x0328, 0x05,
	0x0329, 0x00,	 
	0x033D, 0x83,
	0x0350, 0x03,	 
	0x035E, 0x1A,	 
	0x0364, 0x1A,
	0x037C, 0x00,
	0x037D, 0x00,
	0x037E, 0x00,
	0x03EC, 0x0E,
	0x04B8,	0x50,
	0x04B9,	0x10,
	0x04BA,	0x00,
	0x04BB,	0x04,		
	0x04C8,	0x50,
	0x04C9,	0x10,
	0x04CA,	0x00,
	0x04CB,	0x04,
	0x052C, 0xD3,          
	0x052D, 0x10,          
	0x052E, 0x0D,          		
	0x0558, 0x06,          
	0x0559, 0xE1,          
	0x055A, 0x11,          		
	0x0560, 0x1E,          
	0x0561, 0x61,          
	0x0562, 0x10,          
	0x05B0, 0x50,          
	0x05B1, 0x80,          
	0x05B2, 0x1A,          
	0x05B3, 0x04,

	0x0618,	0xB2,
	0x0619,	0x08,
	0x0680,	0x49,

	0x0200, 0x00,
	0xFFFE, 40,	//delay 40ms
	0x0202, 0x00,
	0x024B, 0x0A,
	0xFFFF, 0xFF,//end flag
};

static const int Sensor_imx290_1080p30f_NORMAL_table_LVDS_10BIT[][2]=
{
	0x0200,	0x01,
	0x0201,	0x00,
	0x0202,	0x01,
	0x0203,	0x00,
	0x0204,	0x10,
	0x0205,	0x00,
	0x0206,	0x00,
	0x0207,	0x00,
	0x0208,	0xA0,
	0x0209,	0x12,
	0x020A,	0x3C,
	0x020B,	0x00,
	0x020C,	0x00,
	0x020D,	0x00,
	0x020E,	0x01,
	0x020F,	0x00,
	0x0210,	0x21,
	0x0211,	0x00,
	0x0212,	0x64,
	0x0213,	0x00,
	0x0214,	0x00,
	0x0215,	0x00,
	0x0216,	0x09,
	0x0217,	0x00,
	0x0218,	0x65,
	0x0219,	0x04,
	0x021A,	0x00,
	0x021B,	0x00,
	0x021C,	0x30,
	0x021D,	0x11,
	0x021E,	0xB2,
	0x021F,	0x01,
	0x0220,	0x00,
	0x0221,	0x00,
	0x0222,	0x00,
	0x023A,	0x0C,
	0x023B,	0x00,
	0x023C,	0x00,
	0x023D,	0x00,
	0x023E,	0x49,
	0x023F,	0x04,
	0x0240,	0x00,
	0x0241,	0x00,
	0x0242,	0x9C,
	0x0243,	0x07,
	//0x0245,	0x03,
	0x0246,	0xE0,
	0x0247,	0x01,
	0x0248,	0x00,
	0x0249,	0x08,
	0x024A,	0x00,
	0x024B,	0x0A,
	0x025C,	0x18,
	0x025D,	0x00,
	0x025E,	0x20,
	0x025F,	0x01,
	0x0270,	0x02,
	0x0271,	0x11,
	0x029B,	0x10,
	0x029C,	0x22,
	0x02A2,	0x02,
	0x02A6,	0x20,
	0x02A7,	0x00,
	0x02A8,	0x20,
	0x02A9,	0x00,
	0x02AA,	0x20,
	0x02AB,	0x00,
	0x02AC,	0x20,
	0x02B0,	0x43,

	//0x0306, 0x1a,
	0x0319, 0x9E,
	0x031C, 0x1E,
	0x031D, 0x00,
	0x031E, 0x08, 
	0x0328, 0x05,
	0x0329, 0x1D,	 
	0x033D, 0x83,
	0x0350, 0x03,	 
	0x035E, 0x1A,	 
	0x0364, 0x1A,
	0x037C, 0x12,
	0x037D, 0x00,
	0x037E, 0x00,
	0x03EC, 0x37,
	0x04B8,	0x50,
	0x04B9,	0x10,
	0x04BA,	0x00,
	0x04BB,	0x04,		
	0x04C8,	0x50,
	0x04C9,	0x10,
	0x04CA,	0x00,
	0x04CB,	0x04,
	0x052C, 0xD3,          
	0x052D, 0x10,          
	0x052E, 0x0D,          		
	0x0558, 0x06,          
	0x0559, 0xE1,          
	0x055A, 0x11,          		
	0x0560, 0x1E,          
	0x0561, 0x61,          
	0x0562, 0x10,          
	0x05B0, 0x50,          
	0x05B1, 0x80,          
	0x05B2, 0x1A,          
	0x05B3, 0x04,
	          	
	0x0680,	0x49,

	0x0200, 0x00,
	0xFFFE, 40,	//delay 40ms
	0x0202, 0x00,
	0x024B, 0x0A,
	0xFFFF, 0xFF,//end flag
};
static const int Sensor_imx290_1080p30f_NORMAL_table_LVDS_12BIT[][2]=
{
	0x0200,	0x01,
	0x0201,	0x00,
	0x0202,	0x01,
	0x0203,	0x00,
	0x0204,	0x10,
	0x0205,	0x01,
	0x0206,	0x00,
	0x0207,	0x00,
	0x0208,	0xA0,
	0x0209,	0x12,
	0x020A,	0x3C,
	0x020B,	0x00,
	0x020C,	0x00,
	0x020D,	0x00,
	0x020E,	0x01,
	0x020F,	0x00,
	0x0210,	0x21,
	0x0211,	0x00,
	0x0212,	0x64,
	0x0213,	0x00,
	0x0214,	0x00,
	0x0215,	0x00,
	0x0216,	0x09,
	0x0217,	0x00,
	0x0218,	0x65,
	0x0219,	0x04,
	0x021A,	0x00,
	0x021B,	0x00,
	0x021C,	0x30,
	0x021D,	0x11,
	0x021E,	0xB2,
	0x021F,	0x01,
	0x0220,	0x00,
	0x0221,	0x00,
	0x0222,	0x00,
	0x023A,	0x0C,
	0x023B,	0x00,
	0x023C,	0x00,
	0x023D,	0x00,
	0x023E,	0x49,
	0x023F,	0x04,
	0x0240,	0x00,
	0x0241,	0x00,
	0x0242,	0x9C,
	0x0243,	0x07,
	//0x0245,	0x03,
	0x0246,	0xE1,
	0x0247,	0x01,
	0x0248,	0x00,
	0x0249,	0x08,
	0x024A,	0x00,
	0x024B,	0x0A,
	0x025C,	0x18,
	0x025D,	0x00,
	0x025E,	0x20,
	0x025F,	0x01,
	0x0270,	0x02,
	0x0271,	0x11,
	0x029B,	0x10,
	0x029C,	0x22,
	0x02A2,	0x02,
	0x02A6,	0x20,
	0x02A7,	0x00,
	0x02A8,	0x20,
	0x02A9,	0x00,
	0x02AA,	0x20,
	0x02AB,	0x00,
	0x02AC,	0x20,
	0x02B0,	0x43,

	//0x0306, 0x1a,
	0x0319, 0x9E,
	0x031C, 0x1E,
	0x031D, 0x00,
	0x031E, 0x08, 
	0x0328, 0x05,
	0x0329, 0x00,	 
	0x033D, 0x83,
	0x0350, 0x03,	 
	0x035E, 0x1A,	 
	0x0364, 0x1A,
	0x037C, 0x00,
	0x037D, 0x00,
	0x037E, 0x00,
	0x03EC, 0x0E,
	0x04B8,	0x50,
	0x04B9,	0x10,
	0x04BA,	0x00,
	0x04BB,	0x04,		
	0x04C8,	0x50,
	0x04C9,	0x10,
	0x04CA,	0x00,
	0x04CB,	0x04,
	0x052C, 0xD3,          
	0x052D, 0x10,          
	0x052E, 0x0D,          		
	0x0558, 0x06,          
	0x0559, 0xE1,          
	0x055A, 0x11,          		
	0x0560, 0x1E,          
	0x0561, 0x61,          
	0x0562, 0x10,          
	0x05B0, 0x50,          
	0x05B1, 0x80,          
	0x05B2, 0x1A,          
	0x05B3, 0x04,
	          	
	0x0680,	0x49,

	0x0200, 0x00,
	0xFFFE, 40,	//delay 40ms
	0x0202, 0x00,
	0x024B, 0x0A,
	0xFFFF, 0xFF,//end flag
};

static const int Sensor_imx290_1080p30f_DOL_WDR_table_MIPI_12BIT[][2]=
{
	0x0200,	0x01,
	0x0201,	0x00,
	0x0202,	0x01,
	0x0203,	0x00,
	0x0204,	0x10,
	0x0205,	0x01,
	0x0206,	0x00,
	0x0207,	0x00,
	0x0208,	0xA0,
	0x0209,	0x01,
	0x020A,	0xF0,
	0x020B,	0x00,
	0x020C,	0x11,
	0x020D,	0x00,
	0x020E,	0x01,
	0x020F,	0x00,
	0x0210,	0x21,
	0x0211,	0x00,
	0x0212,	0x64,
	0x0213,	0x00,
	0x0214,	0x00,
	0x0215,	0x00,
	0x0216,	0x09,
	0x0217,	0x00,
	0x0218,	0x65,
	0x0219,	0x04,
	0x021A,	0x00,
	0x021B,	0x00,
	0x021C,	0x98,
	0x021D,	0x08,
	0x021E,	0xB2,
	0x021F,	0x01,
	0x0220,	0x00,
	0x0221,	0x00,
	0x0222,	0x00,
	0x0224,	0x00,
	0x0225,	0x00,
	0x0226,	0x00,
	0x0228,	0x00,
	0x0229,	0x00,
	0x022A,	0x00,
	0x0230,	0x00,
	0x0231,	0x00,
	0x0232,	0x00,
	0x0234,	0x00,
	0x0235,	0x00,
	0x0236,	0x00,
	0x023A,	0x0C,
	0x023B,	0x00,
	0x023C,	0x00,
	0x023D,	0x00,
	0x023E,	0x49,
	0x023F,	0x04,
	0x0240,	0x00,
	0x0241,	0x00,
	0x0242,	0x9C,
	0x0243,	0x07,
	0x0245,	0x05,
	0x0246,	0xE1,
	0x0247,	0x01,
	0x0248,	0x00,
	0x0249,	0x08,
	0x024A,	0x00,
	0x024B,	0x0A,
	0x025C,	0x18,
	0x025D,	0x03,
	0x025E,	0x20,
	0x025F,	0x01,
	0x0270,	0x02,
	0x0271,	0x11,
	0x029B,	0x10,
	0x029C,	0x22,
	0x02A2,	0x02,
	0x02A6,	0x20,
	0x02A7,	0x00,
	0x02A8,	0x20,
	0x02A9,	0x00,
	0x02AA,	0x20,
	0x02AB,	0x00,
	0x02AC,	0x20,
	0x02B0,	0x43,
	
	0x0306, 0x15,
	0x0319, 0x9E,
	0x031C, 0x1E,
	0x031D, 0x00,
	0x031E, 0x08, 
	0x0328, 0x05,
	0x0329, 0x00,	 
	0x033D, 0x83,
	0x0350, 0x03,	 
	0x035E, 0x1A,	 
	0x0364, 0x1A,
	0x037C, 0x00,
	0x037D, 0x00,
	0x037E, 0x00,
	0x03EC, 0x0E,
	0x04B8,	0x50,
	0x04B9,	0x10,
	0x04BA,	0x00,
	0x04BB,	0x04,		
	0x04C8,	0x50,
	0x04C9,	0x10,
	0x04CA,	0x00,
	0x04CB,	0x04,
	0x052C, 0xD3,          
	0x052D, 0x10,          
	0x052E, 0x0D,          		
	0x0558, 0x06,          
	0x0559, 0xE1,          
	0x055A, 0x11,          		
	0x0560, 0x1E,          
	0x0561, 0x61,          
	0x0562, 0x10,          
	0x05B0, 0x50,          
	0x05B1, 0x80,          
	0x05B2, 0x1A,          
	0x05B3, 0x04,
	0x0605,	0x20,          
	0x0606,	0x00,          
	0x0607,	0x03,          	
	0x0614,	0x0A,          	
	0x0618,	0xB2,          
	0x0619,	0x08,          	
	0x062C,	0x47,          
	0x062D,	0x00,                     
	0x0630,	0x0F,          
	0x0631,	0x00,          	
	0x0641,	0x0C,          
	0x0642,	0x0C,          
	0x0643,	0x03,          
	0x0644,	0x20,          
	0x0645,	0x25,          
	0x0646,	0x47,          
	0x0647,	0x00,          
	0x0648,	0x1F,          
	0x0649,	0x00,          
	0x064A,	0x17,          
	0x064B,	0x00,          
	0x064C,	0x0F,          
	0x064D,	0x00,          
	0x064E,	0x17,          
	0x064F,	0x00,          
	0x0650,	0x47,          
	0x0651,	0x00,          
	0x0652,	0x0F,          
	0x0653,	0x00,          
	0x0654,	0x0F,          
	0x0655,	0x00,          	
	0x0672,	0x9C,          
	0x0673,	0x07,          	
	0x0680,	0x49,

	0x0200, 0x00,
	0xFFFE, 40,	//delay 40ms
	0x0202, 0x00,
	0x024B, 0x0A,
	0xFFFF, 0xFF,//end flag
};

static const int Sensor_imx290_1080p30f_NORMAL_table_MIPI_12BIT[][2]=
{
	0x0200,  0x01,
	0x0201,  0x00,
	0x0202,  0x01,
	0x0203,  0x00,
	0x0204,  0x10,
	0x0205,  0x01,
	0x0206,  0x00,
	0x0207,  0x00,
	0x0208,  0xA0,
	0x0209,  0x02,
	0x020A,  0xF0,
	0x020B,  0x00,
	0x020C,  0x00,
	0x020D,  0x00,
	0x020E,  0x01,
	0x020F,  0x00,
	0x0210,  0x21,
	0x0211,  0x00,
	0x0212,  0x64,
	0x0213,  0x00,
	0x0214,  0x00,
	0x0215,  0x00,
	0x0216,  0x09,
	0x0217,  0x00,
	0x0218,  0x65,
	0x0219,  0x04,
	0x021A,  0x00,
	0x021B,  0x00,
	0x021C,  0x30,
	0x021D,  0x11,
	0x021E,  0xB2,
	0x021F,  0x01,
	0x0220,  0x00,
	0x0221,  0x00,
	0x0222,  0x00,
	0x023A,  0x0C,
	0x023B,  0x00,
	0x023C,  0x00,
	0x023D,  0x00,
	0x023E,  0x49,
	0x023F,  0x04,
	0x0240,  0x00,
	0x0241,  0x00,
	0x0242,  0x9C,
	0x0243,  0x07,    
	0x0246,  0x01,
	0x0247,  0x01,
	0x0248,  0x00,
	0x0249,  0x08,
	0x024A,  0x00,
	0x024B,  0x0A,
	0x025C,  0x18,
	0x025D,  0x03,
	0x025E,  0x20,
	0x025F,  0x01,
	0x0270,  0x02,    
	0x0271,  0x11,    
	0x029B,  0x10,    
	0x029C,  0x22,    
	0x02A2,  0x02,    
	0x02A6,  0x20,    
	0x02A7,  0x00,    
	0x02A8,  0x20,    
	0x02A9,  0x00,    
	0x02AA,  0x20,    
	0x02AB,  0x00,    
	0x02AC,  0x20,    
	0x02B0,  0x43, 

	0x0319, 0x9E,
	0x031C, 0x1E,
	0x031D, 0x00,
	0x031E, 0x08,		
	0x0328, 0x05,
	0x0329, 0x00,			
	0x033D, 0x83,			
	0x0350, 0x03,			
	0x035E, 0x1A,			
	0x0364, 0x1A,			
	0x037C, 0x00,
	0x037D, 0x00,
	0x037E, 0x00,			
	0x03EC, 0x0E,

	0x04B8, 0x50,
	0x04B9, 0x10,
	0x04BA, 0x00,
	0x04BB, 0x04,	
	0x04C8, 0x50,
	0x04C9, 0x10,
	0x04CA, 0x00,
	0x04CB, 0x04,

	0x052C, 0xD3,      
	0x052D, 0x10,      
	0x052E, 0x0D,      		
	0x0558, 0x06,      
	0x0559, 0xE1,      
	0x055A, 0x11,      
	0x0560, 0x1E,      
	0x0561, 0x61,      
	0x0562, 0x10,      
	0x05B0, 0x50,      
	0x05B1, 0x80,      
	0x05B2, 0x1A,      
	0x05B3, 0x04,

	0x0605, 0x20,
	0x0606, 0x00,
	0x0607, 0x03,			
	0x0614, 0x0A,			
	0x0618, 0x49,
	0x0619, 0x04,				
	0x062C, 0x47,
	0x062D, 0x00,
	0x0630, 0x0F,
	0x0631, 0x00,
	0x0641, 0x0C,
	0x0642, 0x0C,
	0x0643, 0x03,
	0x0644, 0x20,
	0x0645, 0x25,
	0x0646, 0x47,
	0x0647, 0x00,
	0x0648, 0x1F,
	0x0649, 0x00,
	0x064A, 0x17,
	0x064B, 0x00,
	0x064C, 0x0F,
	0x064D, 0x00,
	0x064E, 0x17,
	0x064F, 0x00,
	0x0650, 0x47,
	0x0651, 0x00,
	0x0652, 0x0F,
	0x0653, 0x00,
	0x0654, 0x0F,
	0x0655, 0x00,			
	0x0672, 0x9C,
	0x0673, 0x07,					
	0x0680, 0x49,   

	0x0200, 0x00,
	0xFFFE, 40,	//delay 40ms
	0x0202, 0x00,
	0x024B, 0x0A,
	0xFFFF, 0xFF,//end flag
};

void sensor_wdr_1080p30f_init(void)
{
    
	//Sensor_LoadRegSetting(Sensor_imx290_1080p30f_DOL_WDR_table);
	Sensor_LoadRegSetting(Sensor_imx290_1080p30f_DOL_WDR_table_LVDS_10BIT);
    printf("-------Sony IMX290 Sensor 1080p 30fps DOL WDR Initial OK!-------\n");
}



void sensor_linear_1080p30f_init(void)
{
    //Sensor_LoadRegSetting(Sensor_imx290_1080p30f_table);
    Sensor_LoadRegSetting(Sensor_imx290_1080p30f_NORMAL_table_LVDS_10BIT);
    printf("-------Sony IMX290 Sensor 1080p 30fps Linear Initial OK!-------\n");
}

